---
title: 动态属性网络框架-2 基本功能实现
author: fexla
date: 2021-11-13
categories: [游戏, 框架设计]
tags: [游戏, 游戏开发, 框架设计, 动态数值网络, 数值, 编程]
---

## 动态属性网络模型

### 属性模型

　　动态属性网络模型的作用是维护各个属性之间的运算关系，并提供一个从一个从数据集得到特定属性的值的接口。

　　各个属性之间的运算关系是一个图，或者说一个网络。我使用一个结构体ModelNode储存一个节点的信息，用结构体动态数组来保存表示各个属性之间的运算关系。

​		一个ModelNode包含：属性类型，三个动态数组分别储存这个属性计算时涉及哪些属性（储存的是动态数组中保存涉及的属性的索引），涉及的属性的计算方式（比如是加上去的还是按百分比提高），哪些属性计算时会涉及到这个属性，如果这个节点是一个数字节点，则还要保存一个数字属性的对象。

　　用ModelNode的数组就可以描述各个属性之间的运算关系了。

![IBdXKs.png](https://z3.ax1x.com/2021/11/12/IBdXKs.png)

![IBdjrn.png](https://z3.ax1x.com/2021/11/12/IBdjrn.png)

　　当我们需要得到某个属性的值的时候，就递归地取值计算，如上图我想知道node5代表的属性的值，就先得到node的值，然后发现node是数字属性，于是先得到node1,node2的值，进行计算后得到node的值然后进行计算后得到node5的值。

　　在这个过程中我们可以设置缓存，每次计算后保存结果，下次取值就直接返回缓存而不用再进行取值和计算，直到会影响到这个节点的节点发生了改变，就清空缓存。清空缓存的操作也是递归地，如果要清空node1，则要去清空node，然后清空node3，node4，node5。（缓存是保存在数据集中的）

　　因为这个网络需要频繁地索引到某个属性，所以我们用List储存ModelNode，而因为外部调用时还是得用属性的类型来调用，所以再额外开个哈希表，保存从属性类型到List位置的映射。

　　每个模型会储存一个版本变量，构造模型的时候版本值为随机数，每次有改变版本值就加一。

### 数值集

　　数值集用List保存了一系列的数值实例，它们的索引和对应在对应模型的Node节点的索引相同。

　　数值集提供一个添加数字属性的接口，用于实现类似buff，装备这些频繁变化的效果。数字属性需要附加在特定的动态属性身上，数字属性会有一个NumModifier结构体的数组，一个NumModifier结构体包含了数字属性和计算方式。
