<!DOCTYPE html><html lang="zh-CN" mode="dark" ><head> <script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> <script type="text/x-mathjax-config"> MathJax.Hub.Config({ tex2jax: { skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'], inlineMath: [['$','$']] } }); </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="天前"><meta name="hour-prompt" content="小时前"><meta name="minute-prompt" content="分钟前"><meta name="justnow-prompt" content="刚刚"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业" /><meta name="author" content="fexla" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="记录一次学校作业…" /><meta property="og:description" content="记录一次学校作业…" /><link rel="canonical" href="https://fexla.github.io/posts/%E5%9F%BA%E4%BA%8Ejavafx%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8-%E5%AD%A6%E6%A0%A1%E4%BD%9C%E4%B8%9A/" /><meta property="og:url" content="https://fexla.github.io/posts/%E5%9F%BA%E4%BA%8Ejavafx%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8-%E5%AD%A6%E6%A0%A1%E4%BD%9C%E4%B8%9A/" /><meta property="og:site_name" content="FEXLA" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-12-24T00:00:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@fexla" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"fexla"},"dateModified":"2021-12-24T00:00:00+08:00","datePublished":"2021-12-24T00:00:00+08:00","description":"记录一次学校作业…","headline":"FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业","mainEntityOfPage":{"@type":"WebPage","@id":"https://fexla.github.io/posts/%E5%9F%BA%E4%BA%8Ejavafx%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8-%E5%AD%A6%E6%A0%A1%E4%BD%9C%E4%B8%9A/"},"url":"https://fexla.github.io/posts/%E5%9F%BA%E4%BA%8Ejavafx%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8-%E5%AD%A6%E6%A0%A1%E4%BD%9C%E4%B8%9A/"}</script><title>FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业 | FEXLA</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="FEXLA"><meta name="application-name" content="FEXLA"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="zh-CN"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/favicons/favicon.ico" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">FEXLA</a></div><div class="site-subtitle font-italic">FEXLA的个人博客</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/fexla" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['2098897033','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> fexla </span> 发表于 <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="2021-12-24, 00:00 +0800" >2021-12-24<i class="unloaded">2021-12-24T00:00:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="7882 字">43 分钟 阅读</span></div></div><div class="post-content"><p>记录一次学校作业…</p><h2 id="需求">需求</h2><p>　　使用哈夫曼算法实现对文件的编码解码。</p><h2 id="基本思路">基本思路</h2><p>　　我选择使用java作为编程语言，使用javafx作为ui框架。</p><p>　　将问题拆分成个3个部分：哈夫曼，BitSet操作，UI。</p><p>　　哈夫曼部分包括了一个哈夫曼树的构建，使用哈夫曼算法编码与解码，哈夫曼树序列化和反序列化。</p><p>　　BitSet部分是指自己根据要求实现一个二进制序列的数据对象。由于哈夫曼算法最终要把原始数据转换为不定长的二进制序列，最终合并转化为一系列字节写入文件，所以二进制序列的操作是不可避免的。java自带的bitset没有实现两个二进制串连接的操作所以只能自己写一个了。</p><p>　　UI部分使用javafx。UI中显示编码与解码两个页面，编码、解码需要选择填写原文件位置，和目标文件位置，编码需要额外填写原文件字符集。</p><p>　　整个程序接口和ui设计的时候留下扩展的余地，以备以后万一想往里加入其它编码方式的编解码。</p><p>　　我直观地猜测，正确定义了字符集后对应地构建哈夫曼树对于大部分的文件可以得到更好的压缩率。</p><p>　　初步的界面设计（初步到很丑，后面一定改）：</p><p><img data-proofer-ignore data-src="https://s4.ax1x.com/2021/12/24/TJUqEQ.png" alt="TJUqEQ.png" style="zoom:50%;" /></p><p><img data-proofer-ignore data-src="https://s4.ax1x.com/2021/12/24/TJaECR.png" alt="TJaECR.png" style="zoom:50%;" /></p><h2 id="算法描述">算法描述</h2><h3 id="哈夫曼算法">哈夫曼算法</h3><p>　　哈夫曼算法的意义在于能得到一颗最优二叉树。</p><p>　　（百度百科）给定N个权值作为N个叶子结点，构造一棵二叉树，若该树的带权路径长度达到最小，称这样的二叉树为最优二叉树，也称为哈夫曼树(Huffman Tree)。哈夫曼树是带权路径长度最短的树，权值较大的结点离根较近。</p><p>　　构建方法是：把给定的N个叶子节点放入一个集合中，每次取出权值最小的两个节点，合成一个新节点，权值为这两个节点的权值和，放入集合中，多次执行直到集合中只剩一个节点，最优二叉树就构建完成了，最后的节点就是二叉树的根节点。其中节点集合使用小根堆来维护，小根堆的特点是堆顶元素总是最小的，单次放入取出元素的时间复杂度都为O(logn)，因为构建哈夫曼树得到的节点总数为2倍叶子节点的数量减1，对集合操作的次数和叶子节点的个数成正比，所以最终时间复杂度为O(nlogn)。</p><p>　　最优二叉树可以用于优化基于判断的查找以及数据压缩。</p><p>　　伪代码表示：</p><pre><code class="language-Pseudocode">turn leaves to nodes
loop if nodes.count &gt; 1
	node_a = nodes.FindAndRemoveBiggest()
	node_b = nodes.FindAndRemoveBiggest()
	node_c.leftNode = node_a
	node_c.rightNode = node_b
	node_c.frequency = node_a.frequency + node_a.frequency
end loop
</code></pre><h3 id="bitset的实现">BitSet的实现</h3><p>　　BitSet的UML图如下：</p><p><img data-proofer-ignore data-src="https://s4.ax1x.com/2021/12/23/TGYebj.png" alt="TGYebj.png" /></p><p>　　在BitSet中，使用long类型的数组来保存二进制序列，用一个long变量表示有效长度，二进制序列的位索引从word[0]的最低位开始计起。</p><p>　　append函数的作用是把一个二进制序列附加到一个二进制序列的前面，参数可以是一个二进制序列也可以是一个long值和一个int值表示有效长度。前者实际上是把要加的二进制序列拆分成若干个long类型的值然后调用后者。</p><p>　　appendlong的步骤是：</p><p>1.对储存数组第一个未填满的位置，使用掩码把超过了validLength（有效长度）处于高位的无效位进行过滤，过滤为0，放置高位上的无效位存在为1的位污染后面的运算。将1左移(validLength % 64)位再减1得到掩码。如：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Text "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>有效位有75位
储存的words[1]为0000000000000000000000000000000001000000000000000001001110101010
	0000000000000000000000000000000001000000000000000001001110101010
&amp;	0000000000000000000000000000000001000000000000000000011111111111
=	0000000000000000000000000000000001000000000000000000001110101010
</pre></table></code></div></div><p>2.将要附加的long值左移(64 - length)位，再右移(64 - length)位，将输入的二进制序列的无效位过滤。</p><p>3.将输入的long值左移(validLength % 64)，和数组第一个未填满的位置进行位或运算，并储存到数组里。</p><p>4.判断要储存输入的二进制序列是否需要数组的下一个位置：将原本的有效位长度和要添加的有效位长度相加，除以八，和原本的有效位长度除以8比较（两个都是向下取整），如果前者大则表示需要后面的位置储存。</p><p>5.如果4为真则把数组的下一位置设置为0并赋值为输入的long值右移(64 - (validLength % 64))位。</p><p>6.有效长度加上增加的长度。</p><p>伪代码：</p><pre><code class="language-Pseudocode">ensureCapacity((int) (validLength + length-1 &gt;&gt;&gt; 6)+1);
words[(int) (validLength &gt;&gt;&gt; 6)] &amp;= (1l &lt;&lt; validLength % 64) - 1l;
value = value &lt;&lt; (64 - length) &gt;&gt;&gt; (64 - length);
words[(int) (validLength &gt;&gt;&gt; 6)] |= value &lt;&lt; validLength % 64;
//如果添加的数据不止影响在words的同一个位置
if (!(validLength + length - 1 &gt;&gt;&gt; 6 == validLength - 1 &gt;&gt;&gt; 6 || validLength % 64 == 0)) {
    words[(int) (validLength &gt;&gt;&gt; 6) + 1] = 0;
    words[(int) (validLength &gt;&gt;&gt; 6) + 1] |= value &gt;&gt;&gt; (64 - (validLength % 64));
}
validLength += length;
</code></pre><h2 id="一些实现细节">一些实现细节</h2><h3 id="生成映射">生成映射</h3><p>　　哈夫曼树构建出来后，我不直接用树来进行编码与解码，而是使用深搜遍历哈夫曼树的所有叶节点，将整棵树转化为字符和二进制序列的映射（即编码），由两个哈希表组成。</p><p>　　具体细节是：声明一个临时的二进制序列bitset，使用深度优先搜索，当往左子树遍历时，给bitset末尾附加1；往左子树遍历时，给bitset末尾附加0；回溯时则将有效长度减少1位。这样这个二进制序列能随时地表示当前节点的二进制序列。当遍历到一个叶节点时就将该叶节点表示的字符和bitset的复制结果存入两个哈希表。</p><p>　　构建映射的时间复杂度为O(n)，n为节点数量，编码解码的时间复杂度都是O(n)，n为要编码、解码的字符串、二进制序列的长度，解码与使用树解码相同。</p><h3 id="二进制文件设计">二进制文件设计</h3><p>　　编码后的二进制文件结构分为三个部分：原文件编码格式，哈夫曼树，编码后的二进制序列。</p><h4 id="原文件编码格式">原文件编码格式</h4><p>　　直接储存字符集的名字来表示原文件编码格式。先是一个4字节的整数，表示名字的长度；然后就是名字的字符串（以Unicode的编码储存）。如果没有字符集则原本表示名字长度的位置写入0.</p><h4 id="哈夫曼树">哈夫曼树</h4><p>　　首先写入树里字符的种类数量，使用一个4字节的整数储存；然后遍历字符到二进制序列的哈希表中的元素，每次遍历先写入字符，（是否是文字字符由上一步来确定。如果是文字字符，这里的字符会被转为char字符然后用Unicode格式储存，占用两个字节；如果是字节，则占用一个字节），然后写入二进制编码的有效长度，最后写入字符对应的二进制序列，字节长度为可以表示有效长度的最小长度。</p><p><img data-proofer-ignore data-src="https://s4.ax1x.com/2021/12/24/TJNOl6.png" alt="TJNOl6.png" /></p><h3 id="日志文件">日志文件</h3><p>　　我希望在编码与译码的时候可以生成一份明文报告，包括是否成功、各个操作耗时、哈夫曼树的具体形态等信息。</p><p>　　我用了比较简陋的实现方法：在编译码的接口上加一个OutputStreamWriter的参数，在编译码的类里添加一个void log(String)方法，如果我想把报告输出为文件，就给一个FileOutPutStream，如果我只想输出到控制台，就把System.out传进去，如果我不想输出，就不传参数进去，在log方法里跳过。</p><h3 id="对字节和文本字符统一处理">对字节和文本字符统一处理</h3><p>　　由于编码的时候要处理把字节看做哈夫曼树的一个叶子和把文本字符看做一个叶子两种情况，所以考虑将两者抽象为一个东西，编解码的时候可以统一处理。我把抽象出来的东西命名为Cell，意思是构建哈夫曼树的基本字符。</p><p>　　Cell的设计如下：</p><p><img data-proofer-ignore data-src="https://s4.ax1x.com/2021/12/24/TJdVoQ.png" alt="TJdVoQ.png" /></p><p>　　value的getter setter没什么好说的，hashCode和equal都是为了他们可以在hashmap中正常工作，getByteArray是因为译码的时候需要知道他们的字节表示。</p><p>　　光有个Cell还不行，还要有个CellReader，它的子类实现有ByteReader，CharReader，TxtReader，他们有不同的构造函数，参数是不同类型的输入流，在读取的时候使用这三种Reader来获得对应种类的Cell。</p><p><img data-proofer-ignore data-src="https://s4.ax1x.com/2021/12/24/TJ4AgK.png" alt="TJ4AgK.png" /></p><p>　　用于读取字符的有两个类：CharReader和TxtReader。区别在于CharReader使用InputStream进行构造，在GetNext方法中读取两个字节然后组合成char值，只能读取Unicode字符；TxtReader使用InputStreamReader进行构造，InputStreamReader可以在流中进行编码转换，能读取所有字符。有CharReader的原因是TxtReader有些情况不能用，InputStreamReader会对读取的输入流缓存（而且没法取消），在编码的时候没什么问题，但是在反序列化哈夫曼树的时候，字符和数字交叉写在文件中，读取数字需要用字节流读取，读取字符要用CellReader读取，也就是说多个转换流共用一个输入流，如果InputStreamReader缓存了，输入流读到后面去了，其他转换流就会出问题。于是在编码的过程中使用TxtReader，在解码的过程中使用CharReader。编码的结果如果要存字符，一定使用Unicode编码，因为java中字符变量本身就是Unicode编码储存的，使用Unicode字符集读取与写入都只需要几次位运算就可以得到期望的结果。</p><h2 id="具体实现">具体实现</h2><p>两个编码器解码器接口的定义：</p><p>编码器：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kd">public</span>  <span class="kd">interface</span> <span class="nc">Coder</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="nf">Encode</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">is</span><span class="o">,</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>解码器：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStreamWriter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Decoder</span> <span class="o">{</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="nf">decode</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">is</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Cell：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman.cell</span><span class="o">;</span>

<span class="cm">/**
 * 表示最小的编解码的单位，
 * 比如在文本文件中，一个字就是一个Code
 * 在二进制文件中，一个字节就是一个Code
 */</span>
<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">Cell</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="no">T</span> <span class="nf">getValue</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="no">T</span> <span class="n">value</span><span class="o">);</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getByteArray</span><span class="o">();</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman.cell</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ByteCell</span> <span class="kd">extends</span> <span class="nc">Cell</span><span class="o">&lt;</span><span class="nc">Byte</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">byte</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Byte</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="nc">Byte</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">ByteCell</span><span class="o">(</span><span class="kt">byte</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getByteArray</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[]{</span><span class="n">value</span><span class="o">};</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">ByteCell</span><span class="o">)</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="o">((</span><span class="nc">ByteCell</span><span class="o">)</span> <span class="n">obj</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman.cell</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.CharArrayWriter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.DataOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.Charset</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TxtCell</span> <span class="kd">extends</span> <span class="nc">Cell</span><span class="o">&lt;</span><span class="nc">Character</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">char</span> <span class="n">value</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Character</span> <span class="nf">getValue</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setValue</span><span class="o">(</span><span class="nc">Character</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">getByteArray</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
        <span class="n">b</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">((</span><span class="n">value</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">8</span><span class="o">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="o">);</span>
        <span class="n">b</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">((</span><span class="n">value</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">b</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">TxtCell</span><span class="o">(</span><span class="kt">char</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">obj</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="nc">TxtCell</span><span class="o">)</span>
            <span class="k">return</span> <span class="n">value</span> <span class="o">==</span> <span class="o">((</span><span class="nc">TxtCell</span><span class="o">)</span> <span class="n">obj</span><span class="o">).</span><span class="na">getValue</span><span class="o">();</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman.cell.reader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.Cell</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">CellReader</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Cell</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="no">T</span> <span class="nf">GetNext</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="kt">void</span> <span class="nf">setSource</span><span class="o">(</span><span class="nc">Object</span> <span class="n">source</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman.cell.reader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.ByteCell</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ByteReader</span> <span class="kd">extends</span> <span class="nc">CellReader</span><span class="o">&lt;</span><span class="nc">ByteCell</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">InputStream</span> <span class="n">reader</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">ByteReader</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">inputStream</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">ByteCell</span> <span class="nf">GetNext</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">c</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">ByteCell</span><span class="o">((</span><span class="kt">byte</span><span class="o">)</span> <span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSource</span><span class="o">(</span><span class="nc">Object</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">source</span> <span class="k">instanceof</span> <span class="nc">InputStream</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="o">(</span><span class="nc">InputStream</span><span class="o">)</span> <span class="n">source</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman.cell.reader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.TxtCell</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">CharReader</span> <span class="kd">extends</span> <span class="nc">CellReader</span><span class="o">&lt;</span><span class="nc">TxtCell</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">InputStream</span> <span class="n">reader</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">CharReader</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">inputStream</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">TxtCell</span> <span class="nf">GetNext</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">byte</span> <span class="n">a</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">(),</span> <span class="n">b</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
        <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="o">(</span><span class="kt">char</span><span class="o">)</span> <span class="o">(((</span><span class="n">a</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="o">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span><span class="o">)</span> <span class="o">|</span> <span class="o">(</span><span class="n">b</span> <span class="o">&amp;</span> <span class="mh">0xFF</span><span class="o">));</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TxtCell</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSource</span><span class="o">(</span><span class="nc">Object</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">source</span> <span class="k">instanceof</span> <span class="nc">InputStream</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="o">(</span><span class="nc">InputStream</span><span class="o">)</span> <span class="n">source</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman.cell.reader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.TxtCell</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TxtReader</span> <span class="kd">extends</span> <span class="nc">CellReader</span><span class="o">&lt;</span><span class="nc">TxtCell</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">InputStreamReader</span> <span class="n">reader</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">TxtReader</span><span class="o">(</span><span class="nc">InputStreamReader</span> <span class="n">inputStream</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">inputStream</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">TxtCell</span> <span class="nf">GetNext</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span>  <span class="n">reader</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">return</span> <span class="k">new</span> <span class="nf">TxtCell</span><span class="o">((</span><span class="kt">char</span><span class="o">)</span> <span class="n">value</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSource</span><span class="o">(</span><span class="nc">Object</span> <span class="n">source</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">source</span> <span class="k">instanceof</span> <span class="nc">InputStreamReader</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">reader</span> <span class="o">=</span> <span class="o">(</span><span class="nc">InputStreamReader</span><span class="o">)</span> <span class="n">source</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>数据结构的实现：</p><p>小根堆：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// 小根堆</span>
<span class="c1">/// compare反过来就是大根堆</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;typeparam name="T"&gt;堆内元素的类型&lt;/typeparam&gt;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Heap</span><span class="o">&lt;</span><span class="no">T</span> <span class="kd">extends</span> <span class="nc">Comparable</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="c1">//堆内元素</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="no">T</span><span class="o">&gt;</span> <span class="n">num</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Heap</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">num</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
    <span class="o">}</span>

    <span class="c1">//自下而上更新堆</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">Update</span><span class="o">(</span><span class="kt">int</span> <span class="n">ind</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ind</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ind</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ind</span> <span class="o">/</span> <span class="mi">2</span><span class="o">))</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Swap</span><span class="o">(</span><span class="n">ind</span><span class="o">,</span> <span class="n">ind</span> <span class="o">/</span> <span class="mi">2</span><span class="o">);</span>
            <span class="nc">Update</span><span class="o">(</span><span class="n">ind</span> <span class="o">/</span> <span class="mi">2</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">//num.get().compareTo(num.get())</span>
    <span class="c1">//自上而下更新堆</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">UpdateDown</span><span class="o">(</span><span class="kt">int</span> <span class="n">ind</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ind</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">ind</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="n">num</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="k">return</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">n</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ind</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">&gt;=</span> <span class="n">num</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">ind</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ind</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ind</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">))</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">ind</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">ind</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ind</span><span class="o">).</span><span class="na">compareTo</span><span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">n</span><span class="o">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Swap</span><span class="o">(</span><span class="n">ind</span><span class="o">,</span> <span class="n">n</span><span class="o">);</span>
            <span class="nc">UpdateDown</span><span class="o">(</span><span class="n">n</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">Swap</span><span class="o">(</span><span class="kt">int</span> <span class="n">ind1</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ind2</span><span class="o">)</span> <span class="o">{</span>
        <span class="no">T</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ind1</span><span class="o">);</span>
        <span class="n">num</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">ind1</span><span class="o">,</span> <span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ind2</span><span class="o">));</span>
        <span class="n">num</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">ind2</span><span class="o">,</span> <span class="n">temp</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//把一个元素压入堆中</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">PushBack</span><span class="o">(</span><span class="no">T</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">num</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>
        <span class="nc">Update</span><span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="no">T</span> <span class="nf">Get</span><span class="o">(</span><span class="kt">int</span> <span class="n">ind</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">ind</span> <span class="o">&gt;=</span> <span class="n">num</span><span class="o">.</span><span class="na">size</span><span class="o">())</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">ind</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="no">T</span> <span class="nf">Top</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//取出堆顶元素</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">Pop</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="n">num</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="n">num</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">));</span>
        <span class="n">num</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">num</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">-</span> <span class="mi">1</span><span class="o">);</span>
        <span class="nc">UpdateDown</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">//返回堆内元素的数量</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isEmpty</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">num</span><span class="o">.</span><span class="na">isEmpty</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>​ 二进制序列：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.util</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.math.BigInteger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.ByteBuffer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.ByteOrder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Arrays</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BitSet</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kt">long</span><span class="o">[]</span> <span class="n">words</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">long</span> <span class="n">validLength</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BitSet</span> <span class="no">ONE</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BitSet</span><span class="o">(</span><span class="k">new</span> <span class="kt">long</span><span class="o">[]{</span><span class="mi">1</span><span class="o">},</span> <span class="mi">1</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BitSet</span> <span class="no">ZERO</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BitSet</span><span class="o">(</span><span class="k">new</span> <span class="kt">long</span><span class="o">[]{</span><span class="mi">0</span><span class="o">},</span> <span class="mi">1</span><span class="o">);</span>

    <span class="kd">public</span> <span class="nf">BitSet</span><span class="o">(</span><span class="kt">long</span><span class="o">[]</span> <span class="n">words</span><span class="o">,</span> <span class="kt">long</span> <span class="n">validLength</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">words</span> <span class="o">=</span> <span class="n">words</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">validLength</span> <span class="o">=</span> <span class="n">validLength</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">BitSet</span><span class="o">(</span><span class="kt">long</span> <span class="n">validLength</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">words</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">((</span><span class="n">validLength</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)];</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">BitSet</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">words</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[]{</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">};</span>
        <span class="n">validLength</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">append</span><span class="o">(</span><span class="nc">BitSet</span> <span class="n">set</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">long</span><span class="o">[]</span> <span class="n">appendWords</span> <span class="o">=</span> <span class="n">set</span><span class="o">.</span><span class="na">words</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">set</span><span class="o">.</span><span class="na">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">appendLong</span><span class="o">(</span><span class="n">appendWords</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="mi">64</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">appendLong</span><span class="o">(</span><span class="n">appendWords</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="o">.</span><span class="na">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)],</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">set</span><span class="o">.</span><span class="na">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">appendLong</span><span class="o">(</span><span class="kt">long</span> <span class="n">value</span><span class="o">,</span> <span class="kt">int</span> <span class="n">length</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ensureCapacity</span><span class="o">((</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">+</span> <span class="n">length</span><span class="o">-</span><span class="mi">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)+</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)]</span> <span class="o">&amp;=</span> <span class="o">(</span><span class="mi">1</span><span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">)</span> <span class="o">-</span> <span class="mi">1</span><span class="n">l</span><span class="o">;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">length</span><span class="o">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">length</span><span class="o">);</span>
        <span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)]</span> <span class="o">|=</span> <span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">;</span>
        <span class="c1">//如果添加的数据不止影响在word的同一个位置</span>
        <span class="k">if</span> <span class="o">(!(</span><span class="n">validLength</span> <span class="o">+</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span> <span class="o">==</span> <span class="n">validLength</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span> <span class="o">||</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span> <span class="o">==</span> <span class="mi">0</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">]</span> <span class="o">|=</span> <span class="n">value</span> <span class="o">&gt;&gt;&gt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">validLength</span> <span class="o">+=</span> <span class="n">length</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">ensureCapacity</span><span class="o">(</span><span class="kt">int</span> <span class="n">wordsRequired</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">words</span><span class="o">.</span><span class="na">length</span> <span class="o">&lt;</span> <span class="n">wordsRequired</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// 分配空间</span>
            <span class="kt">int</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">words</span><span class="o">.</span><span class="na">length</span><span class="o">,</span> <span class="n">wordsRequired</span><span class="o">);</span>
            <span class="n">words</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">words</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">bitAt</span><span class="o">(</span><span class="kt">long</span> <span class="n">index</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">((</span><span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">index</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)]</span> <span class="o">&amp;</span> <span class="o">(</span><span class="mi">1</span><span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="n">index</span> <span class="o">%</span> <span class="mi">64</span><span class="o">))</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">index</span> <span class="o">%</span> <span class="mi">64</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">bitSet</span><span class="o">(</span><span class="kt">long</span> <span class="n">index</span><span class="o">,</span> <span class="kt">int</span> <span class="n">value</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">index</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)]</span> <span class="o">&amp;=</span> <span class="o">(-</span><span class="mi">1</span><span class="n">l</span> <span class="o">-</span> <span class="o">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="n">index</span> <span class="o">%</span> <span class="mi">64</span><span class="o">)));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">index</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)]</span> <span class="o">|=</span> <span class="mi">1</span><span class="n">l</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="n">index</span> <span class="o">%</span> <span class="mi">64</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="n">validLength</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
            <span class="n">str</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">bitAt</span><span class="o">(</span><span class="n">i</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">clone</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">long</span><span class="o">[]</span> <span class="n">cloneWords</span> <span class="o">=</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">copyOf</span><span class="o">(</span><span class="n">words</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BitSet</span><span class="o">(</span><span class="n">cloneWords</span><span class="o">,</span> <span class="n">validLength</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">equals</span><span class="o">(</span><span class="nc">Object</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">o</span><span class="o">)</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">o</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="n">getClass</span><span class="o">()</span> <span class="o">!=</span> <span class="n">o</span><span class="o">.</span><span class="na">getClass</span><span class="o">())</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="nc">BitSet</span> <span class="n">bitSet</span> <span class="o">=</span> <span class="o">(</span><span class="nc">BitSet</span><span class="o">)</span> <span class="n">o</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">bitSet</span><span class="o">.</span><span class="na">validLength</span> <span class="o">!=</span> <span class="n">validLength</span><span class="o">)</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">bitSet</span><span class="o">.</span><span class="na">words</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">!=</span> <span class="n">words</span><span class="o">[</span><span class="n">i</span><span class="o">])</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="kt">long</span> <span class="n">lasta</span> <span class="o">=</span> <span class="o">(</span><span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)]</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">))</span> <span class="o">&gt;&gt;&gt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">lastb</span> <span class="o">=</span> <span class="o">(</span><span class="n">bitSet</span><span class="o">.</span><span class="na">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)]</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">))</span> <span class="o">&gt;&gt;&gt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">lasta</span> <span class="o">==</span> <span class="n">lastb</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">hashCode</span><span class="o">()</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">h</span> <span class="o">=</span> <span class="s">"fexla"</span><span class="o">.</span><span class="na">hashCode</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">);</span> <span class="o">--</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">;</span> <span class="o">)</span>
            <span class="n">h</span> <span class="o">^=</span> <span class="n">words</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">*</span> <span class="o">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="kt">long</span> <span class="n">last</span> <span class="o">=</span> <span class="o">(</span><span class="n">words</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)]</span> <span class="o">&lt;&lt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">))</span> <span class="o">&gt;&gt;&gt;</span> <span class="o">(</span><span class="mi">64</span> <span class="o">-</span> <span class="n">validLength</span> <span class="o">%</span> <span class="mi">64</span><span class="o">);</span>
        <span class="n">h</span> <span class="o">^=</span> <span class="n">last</span> <span class="o">*</span> <span class="o">((</span><span class="n">validLength</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="k">return</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">((</span><span class="n">h</span> <span class="o">&gt;&gt;</span> <span class="mi">32</span><span class="o">)</span> <span class="o">^</span> <span class="n">h</span><span class="o">)</span> <span class="o">^</span> <span class="nc">Long</span><span class="o">.</span><span class="na">hashCode</span><span class="o">(</span><span class="n">validLength</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">narrow</span><span class="o">(</span><span class="kt">long</span> <span class="n">size</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">validLength</span> <span class="o">-=</span> <span class="n">size</span><span class="o">;</span>
        <span class="n">validLength</span> <span class="o">=</span> <span class="n">validLength</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">validLength</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>
        <span class="c1">//清除原位置的值</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span> <span class="o">&gt;&gt;</span> <span class="mi">3</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">appendLong</span><span class="o">(</span><span class="mi">0</span><span class="n">l</span><span class="o">,</span> <span class="mi">64</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">appendLong</span><span class="o">(</span><span class="mi">0</span><span class="n">l</span><span class="o">,</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">size</span> <span class="o">%</span> <span class="mi">64</span><span class="o">));</span>
        <span class="n">validLength</span> <span class="o">-=</span> <span class="n">size</span><span class="o">;</span>
        <span class="n">validLength</span> <span class="o">=</span> <span class="n">validLength</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="n">validLength</span> <span class="o">:</span> <span class="mi">0</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="cm">/**
     * 将储存的二进制序列转为byte数组
     *
     * @return byte数组
     */</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">toByteArray</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">((</span><span class="n">validLength</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">len</span><span class="o">];</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">bytes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span> <span class="o">(</span><span class="n">words</span><span class="o">[</span><span class="n">i</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span><span class="o">]</span> <span class="o">&gt;&gt;&gt;</span> <span class="o">(</span><span class="mi">8</span> <span class="o">*</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">8</span><span class="o">)));</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">bytes</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">BitSet</span> <span class="nf">valueOf</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nf">valueOf</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span> <span class="n">bytes</span><span class="o">.</span><span class="na">length</span> <span class="o">*</span> <span class="mi">8</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">BitSet</span> <span class="nf">valueOf</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">,</span> <span class="kt">int</span> <span class="n">validLength</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="k">return</span> <span class="k">new</span> <span class="nc">BitSet</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">words</span><span class="o">[]</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[(</span><span class="kt">int</span><span class="o">)</span> <span class="o">((</span><span class="n">validLength</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)];</span>
        <span class="kt">int</span> <span class="n">byteLen</span> <span class="o">=</span> <span class="o">((</span><span class="n">validLength</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">byteLen</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">words</span><span class="o">[</span><span class="n">i</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span><span class="o">]</span> <span class="o">|=</span> <span class="o">(</span><span class="n">bytes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="n">l</span><span class="o">)</span> <span class="o">&lt;&lt;</span> <span class="mi">8</span> <span class="o">*</span> <span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">8</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BitSet</span><span class="o">(</span><span class="n">words</span><span class="o">,</span> <span class="n">validLength</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BigInteger</span> <span class="n">bitSignificance</span> <span class="o">=</span> <span class="nc">BigInteger</span><span class="o">.</span><span class="na">TWO</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="mi">64</span><span class="o">);</span><span class="c1">//2^64,表示一个long位的权值</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="nc">BigInteger</span> <span class="n">signSignificance</span> <span class="o">=</span> <span class="nc">BigInteger</span><span class="o">.</span><span class="na">TWO</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="mi">63</span><span class="o">);</span><span class="c1">//2^63,表示一个long原本表示符号的位代表的值</span>

    <span class="cm">/**
     * 二进制序列转BigInteger
     *
     * @return
     */</span>
    <span class="kd">public</span> <span class="nc">BigInteger</span> <span class="nf">toBigInteger</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">BigInteger</span> <span class="n">result</span> <span class="o">=</span> <span class="nc">BigInteger</span><span class="o">.</span><span class="na">ZERO</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="o">(</span><span class="n">validLength</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">6</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">--)</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">value</span> <span class="o">=</span> <span class="n">words</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">)</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">bitSignificance</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="nc">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">value</span><span class="o">));</span>
            <span class="k">else</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">multiply</span><span class="o">(</span><span class="n">bitSignificance</span><span class="o">).</span><span class="na">add</span><span class="o">(</span><span class="nc">BigInteger</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">value</span> <span class="o">&amp;</span> <span class="nc">Long</span><span class="o">.</span><span class="na">MAX_VALUE</span><span class="o">)).</span><span class="na">add</span><span class="o">(</span><span class="n">signSignificance</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">clear</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">words</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">long</span><span class="o">[</span><span class="n">words</span><span class="o">.</span><span class="na">length</span><span class="o">];</span>
        <span class="n">validLength</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">long</span> <span class="nf">getValidLength</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">validLength</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>哈夫曼编解码器类：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fexla.codec.Coder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.Decoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.Cell</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.ByteReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.CellReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.CharReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.TxtReader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.Charset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.UnsupportedCharsetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Haffuman</span> <span class="kd">implements</span> <span class="nc">Coder</span><span class="o">,</span> <span class="nc">Decoder</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">OutputStreamWriter</span> <span class="n">logger</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Haffuman</span><span class="o">(</span><span class="nc">OutputStreamWriter</span> <span class="n">logger</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">Encode</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">is</span><span class="o">,</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">startms</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="nc">CellReader</span> <span class="n">cellReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="nc">Charset</span> <span class="n">charset</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="c1">//如果有设定编码，把cellReader赋值为一个特定编码集的TxtCellReader</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">args</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="s">"ANSI"</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">charset</span> <span class="o">=</span> <span class="nc">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="n">log</span><span class="o">(</span><span class="s">"编码集为： "</span> <span class="o">+</span> <span class="n">charset</span><span class="o">.</span><span class="na">name</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnsupportedCharsetException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"不支持的编码集\n"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">cellReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TxtReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">,</span> <span class="n">charset</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="c1">//读入的同时统计每个Cell出现的频率频率</span>
        <span class="nc">Cell</span> <span class="n">b</span><span class="o">;</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">&gt;</span> <span class="n">cells</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">freq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="k">while</span> <span class="o">((</span><span class="n">b</span> <span class="o">=</span> <span class="n">cellReader</span><span class="o">.</span><span class="na">GetNext</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">cells</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
            <span class="n">freq</span><span class="o">.</span><span class="na">compute</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">log</span><span class="o">(</span><span class="s">"\n字符频率表：\n"</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">loop</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">freq</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">Cell</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
            <span class="nc">Integer</span> <span class="n">fre</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
            <span class="n">log</span><span class="o">(</span><span class="n">cell</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="s">"  "</span> <span class="o">+</span> <span class="n">fre</span> <span class="o">+</span> <span class="s">"\t\t"</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(++</span><span class="n">loop</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">log</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">long</span> <span class="n">treeStartms</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="nc">HaffumanTree</span> <span class="n">tree</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HaffumanTree</span><span class="o">(</span><span class="n">freq</span><span class="o">);</span>
        <span class="n">log</span><span class="o">(</span><span class="s">"\n构建哈夫曼树耗时： "</span> <span class="o">+</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">treeStartms</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms\n"</span><span class="o">);</span>
        <span class="nc">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">charset</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span><span class="c1">//写入源文件的编码集名字</span>
            <span class="k">new</span> <span class="nf">DataOutputStream</span><span class="o">(</span><span class="n">baos</span><span class="o">).</span><span class="na">writeInt</span><span class="o">(</span><span class="n">charset</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">length</span><span class="o">());</span>
            <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">charset</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16BE</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">DataOutputStream</span><span class="o">(</span><span class="n">baos</span><span class="o">).</span><span class="na">writeInt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">long</span> <span class="n">encodeStartms</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">tree</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span><span class="c1">//将哈夫曼树序列化并写入</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">tree</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">cells</span><span class="o">).</span><span class="na">toByteArray</span><span class="o">());</span><span class="c1">//写入编码得到的byte数组</span>
        <span class="n">log</span><span class="o">(</span><span class="s">"\n编码耗时： "</span> <span class="o">+</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">encodeStartms</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms\n"</span><span class="o">);</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
        <span class="n">log</span><span class="o">(</span><span class="s">"\n总耗时： "</span> <span class="o">+</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startms</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms\n"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">decode</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">is</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">CellReader</span> <span class="n">cellReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="nc">DataInputStream</span> <span class="n">dataInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataInputStream</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">charsetNameLen</span> <span class="o">=</span> <span class="n">dataInputStream</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span><span class="c1">//读取字符集名字的长度</span>
        <span class="nc">Charset</span> <span class="n">charset</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">charsetNameLen</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span><span class="c1">//读取字符集</span>
            <span class="nc">StringBuilder</span> <span class="n">charsetName</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">charsetNameLen</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">charsetName</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">dataInputStream</span><span class="o">.</span><span class="na">readChar</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="n">log</span><span class="o">(</span><span class="s">"charset = "</span> <span class="o">+</span> <span class="n">charsetName</span><span class="o">);</span>
            <span class="n">charset</span> <span class="o">=</span> <span class="nc">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">charsetName</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">cellReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CharReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nc">HaffumanTree</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">HaffumanTree</span><span class="o">.</span><span class="na">deSerialize</span><span class="o">(</span><span class="n">is</span><span class="o">,</span> <span class="n">cellReader</span><span class="o">);</span><span class="c1">//解码出哈夫曼树</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="nc">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="nc">ByteArrayOutputStream</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Cell</span> <span class="n">cell</span> <span class="o">:</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">data</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">cell</span><span class="o">.</span><span class="na">getByteArray</span><span class="o">());</span>
        <span class="o">}</span>
<span class="c1">//        new OutputStreamWriter(baos).write(charset.encode(CharBuffer.wrap(data.toByteArray())));</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">charset</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16BE</span><span class="o">).</span><span class="na">getBytes</span><span class="o">(</span><span class="n">charset</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">data</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">data</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="nc">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">logger</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>哈夫曼树：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.Cell</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.CellReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.util.BitSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.util.Heap</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HaffumanTree</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">BitSet</span><span class="o">&gt;</span> <span class="n">cell2Bit</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">,</span> <span class="nc">Cell</span><span class="o">&gt;</span> <span class="nc">Bit2cell</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">height</span><span class="o">;</span><span class="c1">//哈夫曼树的高度</span>


    <span class="kd">public</span> <span class="nf">HaffumanTree</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">freq</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">cell2Bit</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="nc">Bit2cell</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="nc">Heap</span><span class="o">&lt;</span><span class="nc">Node</span><span class="o">&gt;</span> <span class="n">heap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Heap</span><span class="o">&lt;&gt;();</span>
        <span class="n">freq</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">heap</span><span class="o">.</span><span class="na">PushBack</span><span class="o">(</span><span class="k">new</span> <span class="nc">Node</span><span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)));</span><span class="c1">//所有字符都压入小根堆</span>
        <span class="k">while</span> <span class="o">(</span><span class="n">heap</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Node</span> <span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">,</span> <span class="n">parent</span><span class="o">;</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">Top</span><span class="o">();</span>
            <span class="n">heap</span><span class="o">.</span><span class="na">Pop</span><span class="o">();</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">Top</span><span class="o">();</span>
            <span class="n">heap</span><span class="o">.</span><span class="na">Pop</span><span class="o">();</span>
            <span class="n">parent</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Node</span><span class="o">(</span><span class="n">a</span><span class="o">,</span> <span class="n">b</span><span class="o">);</span>
            <span class="n">heap</span><span class="o">.</span><span class="na">PushBack</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="nc">Node</span> <span class="n">root</span> <span class="o">=</span> <span class="n">heap</span><span class="o">.</span><span class="na">Top</span><span class="o">();</span>
        <span class="n">height</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="na">height</span><span class="o">;</span>
        <span class="n">search</span><span class="o">(</span><span class="n">root</span><span class="o">,</span> <span class="k">new</span> <span class="nc">BitSet</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nf">HaffumanTree</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">cell2Bit</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="nc">Bit2cell</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 编码
     *
     * @param cells
     * @return
     */</span>
    <span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">encode</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">&gt;</span> <span class="n">cells</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">BitSet</span> <span class="n">bitSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BitSet</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">cells</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">bitSet</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">cell2Bit</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">cells</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">)));</span>
        <span class="o">}</span>
        <span class="nc">BitSet</span> <span class="n">length</span><span class="o">=</span><span class="k">new</span> <span class="nc">BitSet</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">validLength</span><span class="o">=</span> <span class="n">bitSet</span><span class="o">.</span><span class="na">getValidLength</span><span class="o">();</span>
        <span class="n">validLength</span><span class="o">=</span><span class="nc">Long</span><span class="o">.</span><span class="na">reverseBytes</span><span class="o">(</span><span class="n">validLength</span><span class="o">);</span>
        <span class="n">length</span><span class="o">.</span><span class="na">appendLong</span><span class="o">(</span><span class="n">validLength</span><span class="o">,</span><span class="mi">64</span><span class="o">);</span>
        <span class="n">length</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">bitSet</span><span class="o">);</span>
        <span class="n">bitSet</span><span class="o">=</span><span class="n">length</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">bitSet</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 解码
     *
     * @param is 输入流
     * @return 解码出来的内容
     * @throws IOException
     */</span>
    <span class="kd">public</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">&gt;</span> <span class="nf">decode</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">is</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">BitSet</span> <span class="n">bitSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BitSet</span><span class="o">();</span>
        <span class="kt">long</span> <span class="n">length</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataInputStream</span><span class="o">(</span><span class="n">is</span><span class="o">).</span><span class="na">readLong</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="o">(</span><span class="n">length</span><span class="o">-</span><span class="mi">1</span><span class="o">&gt;&gt;&gt;</span><span class="mi">3</span><span class="o">)+</span><span class="mi">1</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">bitSet</span><span class="o">.</span><span class="na">appendLong</span><span class="o">((</span><span class="kt">byte</span><span class="o">)</span><span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(),</span> <span class="mi">8</span><span class="o">);</span>

        <span class="o">}</span>
        <span class="nc">BitSet</span> <span class="n">tempSet</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BitSet</span><span class="o">();</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">&gt;</span> <span class="n">cells</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="n">tempSet</span><span class="o">.</span><span class="na">appendLong</span><span class="o">(</span><span class="n">bitSet</span><span class="o">.</span><span class="na">bitAt</span><span class="o">(</span><span class="n">i</span><span class="o">),</span> <span class="mi">1</span><span class="o">);</span>
            <span class="nc">Bit2cell</span><span class="o">.</span><span class="na">compute</span><span class="o">(</span><span class="n">tempSet</span><span class="o">,</span> <span class="o">(</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">if</span> <span class="o">(</span><span class="n">v</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">tempSet</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
                    <span class="n">cells</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">v</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="k">return</span> <span class="n">v</span><span class="o">;</span>
            <span class="o">});</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">tempSet</span><span class="o">.</span><span class="na">getValidLength</span><span class="o">()</span> <span class="o">&gt;</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">tempSet</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">cells</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 递归深搜遍历所有节点，得到字符和编码后二进制的映射
     *
     * @param node
     * @param bitSet
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">search</span><span class="o">(</span><span class="nc">Node</span> <span class="n">node</span><span class="o">,</span> <span class="nc">BitSet</span> <span class="n">bitSet</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">cell</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">cell2Bit</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">cell</span><span class="o">,</span> <span class="n">bitSet</span><span class="o">.</span><span class="na">clone</span><span class="o">());</span>
            <span class="nc">Bit2cell</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">bitSet</span><span class="o">.</span><span class="na">clone</span><span class="o">(),</span> <span class="n">node</span><span class="o">.</span><span class="na">cell</span><span class="o">);</span>
            <span class="k">return</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">left</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bitSet</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">BitSet</span><span class="o">.</span><span class="na">ONE</span><span class="o">);</span>
            <span class="n">search</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">left</span><span class="o">,</span> <span class="n">bitSet</span><span class="o">);</span>
            <span class="n">bitSet</span><span class="o">.</span><span class="na">narrow</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">right</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bitSet</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="nc">BitSet</span><span class="o">.</span><span class="na">ZERO</span><span class="o">);</span>
            <span class="n">search</span><span class="o">(</span><span class="n">node</span><span class="o">.</span><span class="na">right</span><span class="o">,</span> <span class="n">bitSet</span><span class="o">);</span>

            <span class="n">bitSet</span><span class="o">.</span><span class="na">narrow</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 将哈夫曼树序列化
     *
     * @return 字节数组
     */</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">serialize</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">ByteArrayOutputStream</span> <span class="n">stream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="n">serialize</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">stream</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 将哈夫曼树序列化，并输出到流中
     */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="o">(</span><span class="nc">OutputStream</span> <span class="n">stream</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">DataOutputStream</span> <span class="n">dataOutputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataOutputStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
        <span class="n">dataOutputStream</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">cell2Bit</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">cell2Bit</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">byteArray</span> <span class="o">=</span> <span class="n">k</span><span class="o">.</span><span class="na">getByteArray</span><span class="o">();</span>
                <span class="n">dataOutputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">byteArray</span><span class="o">);</span>
                <span class="kt">int</span> <span class="n">validLength</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="n">v</span><span class="o">.</span><span class="na">getValidLength</span><span class="o">();</span>
                <span class="n">dataOutputStream</span><span class="o">.</span><span class="na">writeInt</span><span class="o">(</span><span class="n">validLength</span><span class="o">);</span>
                <span class="n">dataOutputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">v</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">HaffumanTree</span> <span class="nf">deSerialize</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">stream</span><span class="o">,</span> <span class="nc">CellReader</span> <span class="n">cellReader</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">HaffumanTree</span> <span class="n">haffumanTree</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HaffumanTree</span><span class="o">();</span>
        <span class="nc">DataInputStream</span> <span class="n">dataInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataInputStream</span><span class="o">(</span><span class="n">stream</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">dataInputStream</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">BitSet</span><span class="o">&gt;</span> <span class="n">cell2Bit</span> <span class="o">=</span> <span class="n">haffumanTree</span><span class="o">.</span><span class="na">cell2Bit</span><span class="o">;</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">,</span> <span class="nc">Cell</span><span class="o">&gt;</span> <span class="nc">Bit2cell</span> <span class="o">=</span> <span class="n">haffumanTree</span><span class="o">.</span><span class="na">Bit2cell</span><span class="o">;</span>
        <span class="kt">int</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">size</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">Cell</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">cellReader</span><span class="o">.</span><span class="na">GetNext</span><span class="o">();</span>
            <span class="kt">int</span> <span class="n">validLength</span> <span class="o">=</span> <span class="n">dataInputStream</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span>
            <span class="n">height</span> <span class="o">=</span> <span class="nc">Math</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">height</span><span class="o">,</span> <span class="n">validLength</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bitsetByteArray</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="na">readNBytes</span><span class="o">(((</span><span class="n">validLength</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">&gt;&gt;&gt;</span> <span class="mi">3</span><span class="o">)</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
            <span class="nc">BitSet</span> <span class="n">bitSet</span> <span class="o">=</span> <span class="nc">BitSet</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">bitsetByteArray</span><span class="o">,</span> <span class="n">validLength</span><span class="o">);</span>
            <span class="n">cell2Bit</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">cell</span><span class="o">,</span> <span class="n">bitSet</span><span class="o">.</span><span class="na">clone</span><span class="o">());</span>
            <span class="nc">Bit2cell</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">bitSet</span><span class="o">.</span><span class="na">clone</span><span class="o">(),</span> <span class="n">cell</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">haffumanTree</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">haffumanTree</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">BitSet</span><span class="o">&gt;</span> <span class="nf">getCell2Bit</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cell2Bit</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCell2Bit</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">BitSet</span><span class="o">&gt;</span> <span class="n">cell2Bit</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">cell2Bit</span> <span class="o">=</span> <span class="n">cell2Bit</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">,</span> <span class="nc">Cell</span><span class="o">&gt;</span> <span class="nf">getBit2cell</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="nc">Bit2cell</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setBit2cell</span><span class="o">(</span><span class="nc">Map</span><span class="o">&lt;</span><span class="nc">BitSet</span><span class="o">,</span> <span class="nc">Cell</span><span class="o">&gt;</span> <span class="n">bit2cell</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Bit2cell</span> <span class="o">=</span> <span class="n">bit2cell</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nc">BitSet</span> <span class="nf">get</span><span class="o">(</span><span class="nc">Cell</span> <span class="n">key</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">cell2Bit</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">key</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">toString</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">StringBuilder</span> <span class="n">str</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
        <span class="n">str</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">cell2Bit</span><span class="o">.</span><span class="na">size</span><span class="o">());</span>
        <span class="n">str</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="sc">'\n'</span><span class="o">);</span>
        <span class="n">cell2Bit</span><span class="o">.</span><span class="na">forEach</span><span class="o">((</span><span class="n">k</span><span class="o">,</span> <span class="n">v</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span>
                <span class="n">str</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">k</span><span class="o">.</span><span class="na">getValue</span><span class="o">()).</span>
                        <span class="n">append</span><span class="o">(</span><span class="s">"\t"</span><span class="o">).</span>
                        <span class="n">append</span><span class="o">(</span><span class="n">v</span><span class="o">).</span><span class="na">append</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
        <span class="o">});</span>
        <span class="k">return</span> <span class="n">str</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">class</span> <span class="nc">Node</span> <span class="kd">implements</span> <span class="nc">Comparable</span><span class="o">&lt;</span><span class="nc">Node</span><span class="o">&gt;</span> <span class="o">{</span>
        <span class="kd">public</span> <span class="nc">Cell</span> <span class="n">cell</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">freq</span><span class="o">;</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="n">height</span><span class="o">;</span><span class="c1">//这个节点被创建时从子孙节点往上数的高度,用于统计整棵树的高度</span>
        <span class="kd">public</span> <span class="nc">Node</span> <span class="n">left</span><span class="o">,</span> <span class="n">right</span><span class="o">,</span> <span class="n">parent</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Node</span><span class="o">(</span><span class="nc">Cell</span> <span class="n">cell</span><span class="o">,</span> <span class="kt">int</span> <span class="n">freq</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">cell</span> <span class="o">=</span> <span class="n">cell</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">freq</span> <span class="o">=</span> <span class="n">freq</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="nf">Node</span><span class="o">(</span><span class="nc">Node</span> <span class="n">left</span><span class="o">,</span> <span class="nc">Node</span> <span class="n">right</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">left</span> <span class="o">=</span> <span class="n">left</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">;</span>
            <span class="n">left</span><span class="o">.</span><span class="na">parent</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="n">right</span><span class="o">.</span><span class="na">parent</span> <span class="o">=</span> <span class="k">this</span><span class="o">;</span>
            <span class="n">freq</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="na">freq</span> <span class="o">+</span> <span class="n">right</span><span class="o">.</span><span class="na">freq</span><span class="o">;</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="na">height</span> <span class="o">&gt;</span> <span class="n">right</span><span class="o">.</span><span class="na">height</span> <span class="o">?</span> <span class="n">left</span><span class="o">.</span><span class="na">height</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">right</span><span class="o">.</span><span class="na">height</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@Override</span>
        <span class="kd">public</span> <span class="kt">int</span> <span class="nf">compareTo</span><span class="o">(</span><span class="nc">Node</span> <span class="n">o</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">freq</span> <span class="o">-</span> <span class="n">o</span><span class="o">.</span><span class="na">freq</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>哈夫曼编码解码器：</p><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.haffuman</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fexla.codec.Coder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.Decoder</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.Cell</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.ByteReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.CellReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.CharReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.cell.reader.TxtReader</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.Charset</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.StandardCharsets</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.nio.charset.UnsupportedCharsetException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.HashMap</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Map</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Haffuman</span> <span class="kd">implements</span> <span class="nc">Coder</span><span class="o">,</span> <span class="nc">Decoder</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">OutputStreamWriter</span> <span class="n">logger</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Haffuman</span><span class="o">(</span><span class="nc">OutputStreamWriter</span> <span class="n">logger</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">logger</span> <span class="o">=</span> <span class="n">logger</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">Encode</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">is</span><span class="o">,</span> <span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="kt">long</span> <span class="n">startms</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="nc">CellReader</span> <span class="n">cellReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="nc">Charset</span> <span class="n">charset</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="c1">//如果有设定编码，把cellReader赋值为一个特定编码集的TxtCellReader</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">args</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">args</span><span class="o">.</span><span class="na">length</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="s">""</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">].</span><span class="na">equals</span><span class="o">(</span><span class="s">"ANSI"</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">charset</span> <span class="o">=</span> <span class="nc">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="n">log</span><span class="o">(</span><span class="s">"编码集为： "</span> <span class="o">+</span> <span class="n">charset</span><span class="o">.</span><span class="na">name</span><span class="o">()</span> <span class="o">+</span> <span class="s">"\n"</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">UnsupportedCharsetException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"不支持的编码集\n"</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">cellReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">TxtReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">,</span> <span class="n">charset</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="c1">//读入的同时统计每个Cell出现的频率频率</span>
        <span class="nc">Cell</span> <span class="n">b</span><span class="o">;</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">&gt;</span> <span class="n">cells</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">freq</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="k">while</span> <span class="o">((</span><span class="n">b</span> <span class="o">=</span> <span class="n">cellReader</span><span class="o">.</span><span class="na">GetNext</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">cells</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
            <span class="n">freq</span><span class="o">.</span><span class="na">compute</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="o">(</span><span class="n">key</span><span class="o">,</span> <span class="n">value</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="n">value</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="n">value</span> <span class="o">+</span> <span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">log</span><span class="o">(</span><span class="s">"\n字符频率表：\n"</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">loop</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Map</span><span class="o">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">,</span> <span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">entry</span> <span class="o">:</span> <span class="n">freq</span><span class="o">.</span><span class="na">entrySet</span><span class="o">())</span> <span class="o">{</span>
            <span class="nc">Cell</span> <span class="n">cell</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getKey</span><span class="o">();</span>
            <span class="nc">Integer</span> <span class="n">fre</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="na">getValue</span><span class="o">();</span>
            <span class="n">log</span><span class="o">(</span><span class="n">cell</span><span class="o">.</span><span class="na">getValue</span><span class="o">()</span> <span class="o">+</span> <span class="s">"  "</span> <span class="o">+</span> <span class="n">fre</span> <span class="o">+</span> <span class="s">"\t\t"</span><span class="o">);</span>
            <span class="k">if</span> <span class="o">(++</span><span class="n">loop</span> <span class="o">%</span> <span class="mi">6</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">log</span><span class="o">(</span><span class="s">"\n"</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">long</span> <span class="n">treeStartms</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="nc">HaffumanTree</span> <span class="n">tree</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HaffumanTree</span><span class="o">(</span><span class="n">freq</span><span class="o">);</span>
        <span class="n">log</span><span class="o">(</span><span class="s">"\n构建哈夫曼树耗时： "</span> <span class="o">+</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">treeStartms</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms\n"</span><span class="o">);</span>
        <span class="nc">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">charset</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span><span class="c1">//写入源文件的编码集名字</span>
            <span class="k">new</span> <span class="nf">DataOutputStream</span><span class="o">(</span><span class="n">baos</span><span class="o">).</span><span class="na">writeInt</span><span class="o">(</span><span class="n">charset</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">length</span><span class="o">());</span>
            <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">charset</span><span class="o">.</span><span class="na">name</span><span class="o">().</span><span class="na">getBytes</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16BE</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="k">new</span> <span class="nf">DataOutputStream</span><span class="o">(</span><span class="n">baos</span><span class="o">).</span><span class="na">writeInt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="kt">long</span> <span class="n">encodeStartms</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
        <span class="n">tree</span><span class="o">.</span><span class="na">serialize</span><span class="o">(</span><span class="n">baos</span><span class="o">);</span><span class="c1">//将哈夫曼树序列化并写入</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">tree</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">cells</span><span class="o">).</span><span class="na">toByteArray</span><span class="o">());</span><span class="c1">//写入编码得到的byte数组</span>
        <span class="n">log</span><span class="o">(</span><span class="s">"\n编码耗时： "</span> <span class="o">+</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">encodeStartms</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms\n"</span><span class="o">);</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">result</span> <span class="o">=</span> <span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
        <span class="n">log</span><span class="o">(</span><span class="s">"\n总耗时： "</span> <span class="o">+</span> <span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">startms</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms\n"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
    <span class="o">}</span>


    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">byte</span><span class="o">[]</span> <span class="nf">decode</span><span class="o">(</span><span class="nc">InputStream</span> <span class="n">is</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">CellReader</span> <span class="n">cellReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="nc">DataInputStream</span> <span class="n">dataInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">DataInputStream</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="kt">int</span> <span class="n">charsetNameLen</span> <span class="o">=</span> <span class="n">dataInputStream</span><span class="o">.</span><span class="na">readInt</span><span class="o">();</span><span class="c1">//读取字符集名字的长度</span>
        <span class="nc">Charset</span> <span class="n">charset</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">charsetNameLen</span> <span class="o">!=</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span><span class="c1">//读取字符集</span>
            <span class="nc">StringBuilder</span> <span class="n">charsetName</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">StringBuilder</span><span class="o">();</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">charsetNameLen</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
                <span class="n">charsetName</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">dataInputStream</span><span class="o">.</span><span class="na">readChar</span><span class="o">());</span>
            <span class="o">}</span>
            <span class="n">log</span><span class="o">(</span><span class="s">"charset = "</span> <span class="o">+</span> <span class="n">charsetName</span><span class="o">);</span>
            <span class="n">charset</span> <span class="o">=</span> <span class="nc">Charset</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="n">charsetName</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">cellReader</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CharReader</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nc">HaffumanTree</span> <span class="n">tree</span> <span class="o">=</span> <span class="nc">HaffumanTree</span><span class="o">.</span><span class="na">deSerialize</span><span class="o">(</span><span class="n">is</span><span class="o">,</span> <span class="n">cellReader</span><span class="o">);</span><span class="c1">//解码出哈夫曼树</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Cell</span><span class="o">&gt;</span> <span class="n">result</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
        <span class="nc">ByteArrayOutputStream</span> <span class="n">baos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="nc">ByteArrayOutputStream</span> <span class="n">data</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ByteArrayOutputStream</span><span class="o">();</span>
        <span class="k">for</span> <span class="o">(</span><span class="nc">Cell</span> <span class="n">cell</span> <span class="o">:</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">data</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">cell</span><span class="o">.</span><span class="na">getByteArray</span><span class="o">());</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">charset</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>
            <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">());</span>
        <span class="k">else</span> <span class="o">{</span>
            <span class="n">baos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">data</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="nc">StandardCharsets</span><span class="o">.</span><span class="na">UTF_16BE</span><span class="o">).</span><span class="na">getBytes</span><span class="o">(</span><span class="n">charset</span><span class="o">));</span>
        <span class="o">}</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">baos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">data</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="n">data</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="k">return</span> <span class="n">baos</span><span class="o">.</span><span class="na">toByteArray</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">log</span><span class="o">(</span><span class="nc">String</span> <span class="n">string</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">logger</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="n">logger</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">string</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>UI：</p><div class="language-xml highlighter-rouge"><div class="code-header"> <span text-data=" XML "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre><td class="rouge-code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="cp">&lt;?import javafx.geometry.*?&gt;</span>
<span class="cp">&lt;?import javafx.scene.control.*?&gt;</span>
<span class="cp">&lt;?import javafx.scene.layout.*?&gt;</span>

<span class="nt">&lt;AnchorPane</span> <span class="na">minHeight=</span><span class="s">"400.0"</span> <span class="na">minWidth=</span><span class="s">"600.0"</span> <span class="na">xmlns=</span><span class="s">"http://javafx.com/javafx/8"</span> <span class="na">xmlns:fx=</span><span class="s">"http://javafx.com/fxml/1"</span> <span class="na">fx:controller=</span><span class="s">"fexla.codec.view.Controller"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;children&gt;</span>
        <span class="nt">&lt;TabPane</span> <span class="na">layoutX=</span><span class="s">"6.0"</span> <span class="na">layoutY=</span><span class="s">"29.0"</span> <span class="na">prefHeight=</span><span class="s">"400.0"</span> <span class="na">prefWidth=</span><span class="s">"600.0"</span> <span class="na">tabClosingPolicy=</span><span class="s">"UNAVAILABLE"</span> <span class="na">AnchorPane.bottomAnchor=</span><span class="s">"0.0"</span> <span class="na">AnchorPane.leftAnchor=</span><span class="s">"0.0"</span> <span class="na">AnchorPane.rightAnchor=</span><span class="s">"0.0"</span> <span class="na">AnchorPane.topAnchor=</span><span class="s">"0.0"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;tabs&gt;</span>
                <span class="nt">&lt;Tab</span> <span class="na">text=</span><span class="s">"哈夫曼编码"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;content&gt;</span>
                        <span class="nt">&lt;AnchorPane</span> <span class="na">minHeight=</span><span class="s">"0.0"</span> <span class="na">minWidth=</span><span class="s">"0.0"</span> <span class="na">prefHeight=</span><span class="s">"180.0"</span> <span class="na">prefWidth=</span><span class="s">"200.0"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;children&gt;</span>
                                <span class="nt">&lt;VBox</span> <span class="na">alignment=</span><span class="s">"TOP_CENTER"</span> <span class="na">prefHeight=</span><span class="s">"342.0"</span> <span class="na">prefWidth=</span><span class="s">"600.0"</span> <span class="na">spacing=</span><span class="s">"20.0"</span> <span class="na">AnchorPane.bottomAnchor=</span><span class="s">"0.0"</span> <span class="na">AnchorPane.leftAnchor=</span><span class="s">"0.0"</span> <span class="na">AnchorPane.rightAnchor=</span><span class="s">"0.0"</span> <span class="na">AnchorPane.topAnchor=</span><span class="s">"0.0"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;children&gt;</span>
                                        <span class="nt">&lt;Button</span> <span class="na">mnemonicParsing=</span><span class="s">"false"</span> <span class="na">onMouseReleased=</span><span class="s">"#onSelectEncodeSource"</span> <span class="na">text=</span><span class="s">"选择文件"</span> <span class="nt">/&gt;</span>
                                        <span class="nt">&lt;ChoiceBox</span> <span class="na">fx:id=</span><span class="s">"choiceBox"</span> <span class="na">prefWidth=</span><span class="s">"100.0"</span> <span class="nt">/&gt;</span>
                              <span class="nt">&lt;TextField</span> <span class="na">fx:id=</span><span class="s">"textField"</span> <span class="na">alignment=</span><span class="s">"TOP_CENTER"</span> <span class="na">maxWidth=</span><span class="s">"200.0"</span> <span class="na">prefHeight=</span><span class="s">"24.0"</span> <span class="na">prefWidth=</span><span class="s">"200.0"</span> <span class="nt">/&gt;</span>
                              <span class="nt">&lt;Button</span> <span class="na">mnemonicParsing=</span><span class="s">"false"</span> <span class="na">onMouseReleased=</span><span class="s">"#onEncode"</span> <span class="na">text=</span><span class="s">"编码"</span> <span class="nt">/&gt;</span>
                                    <span class="nt">&lt;/children&gt;</span>
                                    <span class="nt">&lt;padding&gt;</span>
                                        <span class="nt">&lt;Insets</span> <span class="na">bottom=</span><span class="s">"10.0"</span> <span class="na">left=</span><span class="s">"10.0"</span> <span class="na">right=</span><span class="s">"10.0"</span> <span class="na">top=</span><span class="s">"10.0"</span> <span class="nt">/&gt;</span>
                                    <span class="nt">&lt;/padding&gt;</span>
                                <span class="nt">&lt;/VBox&gt;</span>
                            <span class="nt">&lt;/children&gt;</span>
                        <span class="nt">&lt;/AnchorPane&gt;</span>
                    <span class="nt">&lt;/content&gt;</span>
                <span class="nt">&lt;/Tab&gt;</span>
                <span class="nt">&lt;Tab</span> <span class="na">text=</span><span class="s">"哈夫曼解码"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;content&gt;</span>
                        <span class="nt">&lt;AnchorPane</span> <span class="na">minHeight=</span><span class="s">"0.0"</span> <span class="na">minWidth=</span><span class="s">"0.0"</span> <span class="na">prefHeight=</span><span class="s">"180.0"</span> <span class="na">prefWidth=</span><span class="s">"200.0"</span><span class="nt">&gt;</span>
                     <span class="nt">&lt;children&gt;</span>
                        <span class="nt">&lt;VBox</span> <span class="na">alignment=</span><span class="s">"TOP_CENTER"</span> <span class="na">prefHeight=</span><span class="s">"342.0"</span> <span class="na">prefWidth=</span><span class="s">"600.0"</span> <span class="na">spacing=</span><span class="s">"20.0"</span><span class="nt">&gt;</span>
                           <span class="nt">&lt;children&gt;</span>
                              <span class="nt">&lt;Button</span> <span class="na">mnemonicParsing=</span><span class="s">"false"</span> <span class="na">onMouseReleased=</span><span class="s">"#onSelectDecodingOrigin"</span> <span class="na">text=</span><span class="s">"选择文件"</span> <span class="nt">/&gt;</span>
                              <span class="nt">&lt;Button</span> <span class="na">mnemonicParsing=</span><span class="s">"false"</span> <span class="na">onMouseReleased=</span><span class="s">"#onDecoding"</span> <span class="na">text=</span><span class="s">"解码"</span> <span class="nt">/&gt;</span>
                           <span class="nt">&lt;/children&gt;</span>
                           <span class="nt">&lt;padding&gt;</span>
                              <span class="nt">&lt;Insets</span> <span class="na">bottom=</span><span class="s">"10.0"</span> <span class="na">left=</span><span class="s">"10.0"</span> <span class="na">right=</span><span class="s">"10.0"</span> <span class="na">top=</span><span class="s">"10.0"</span> <span class="nt">/&gt;</span>
                           <span class="nt">&lt;/padding&gt;</span>
                        <span class="nt">&lt;/VBox&gt;</span>
                     <span class="nt">&lt;/children&gt;&lt;/AnchorPane&gt;</span>
                    <span class="nt">&lt;/content&gt;</span>
                <span class="nt">&lt;/Tab&gt;</span>
            <span class="nt">&lt;/tabs&gt;</span>
        <span class="nt">&lt;/TabPane&gt;</span>
    <span class="nt">&lt;/children&gt;</span>
<span class="nt">&lt;/AnchorPane&gt;</span>
</pre></table></code></div></div><div class="language-java highlighter-rouge"><div class="code-header"> <span text-data=" Java "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">fexla.codec.view</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">fexla.codec.Entrance</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">fexla.codec.haffuman.Haffuman</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javafx.fxml.FXML</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javafx.scene.control.ChoiceBox</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javafx.scene.control.TextField</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javafx.stage.FileChooser</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Controller</span> <span class="o">{</span>
    <span class="nd">@FXML</span>
    <span class="kd">private</span> <span class="nc">ChoiceBox</span> <span class="n">choiceBox</span><span class="o">;</span>
    <span class="nd">@FXML</span>
    <span class="kd">private</span> <span class="nc">TextField</span> <span class="n">textField</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initialize</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">choiceBox</span><span class="o">.</span><span class="na">getItems</span><span class="o">().</span><span class="na">addAll</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="s">"无编码"</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">,</span> <span class="s">"Unicode"</span><span class="o">,</span> <span class="s">"ASCII"</span><span class="o">,</span> <span class="s">"ISO_8859_1"</span><span class="o">,</span> <span class="s">"其他"</span><span class="o">});</span>
        <span class="n">choiceBox</span><span class="o">.</span><span class="na">getSelectionModel</span><span class="o">().</span><span class="na">select</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">textField</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">choiceBox</span><span class="o">.</span><span class="na">addEventHandler</span><span class="o">(</span><span class="nc">ChoiceBox</span><span class="o">.</span><span class="na">ON_HIDING</span><span class="o">,</span> <span class="n">event</span> <span class="o">-&gt;</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">choiceBox</span><span class="o">.</span><span class="na">getSelectionModel</span><span class="o">().</span><span class="na">getSelectedItem</span><span class="o">()</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">choiceBox</span><span class="o">.</span><span class="na">getSelectionModel</span><span class="o">().</span><span class="na">getSelectedItem</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"其他"</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">textField</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">textField</span><span class="o">.</span><span class="na">setVisible</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">File</span> <span class="n">encodeSouce</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">File</span> <span class="n">encodeTarget</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">File</span> <span class="n">decodeOrigin</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">File</span> <span class="n">decodeTarget</span><span class="o">;</span>

    <span class="nd">@FXML</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">onSelectEncodeSource</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">encodeSouce</span> <span class="o">=</span> <span class="nc">SelectFile</span><span class="o">(</span><span class="n">encodeSouce</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">encodeSouce</span><span class="o">.</span><span class="na">getPath</span><span class="o">(),</span>
                <span class="k">new</span> <span class="nc">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span><span class="o">(</span><span class="s">"任意文件"</span><span class="o">,</span> <span class="s">"*.*"</span><span class="o">),</span> <span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@FXML</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">onEncode</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">encodeTarget</span> <span class="o">=</span> <span class="nc">SelectFile</span><span class="o">(</span><span class="n">encodeTarget</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">encodeTarget</span><span class="o">.</span><span class="na">getPath</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span><span class="o">(</span><span class="s">"哈夫曼编码二进制"</span><span class="o">,</span> <span class="s">"*.haf"</span><span class="o">),</span> <span class="kc">false</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">encodeTarget</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">encodeSouce</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
        <span class="n">decodeOrigin</span> <span class="o">=</span> <span class="n">encodeTarget</span><span class="o">;</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">args</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">str</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">choiceBox</span><span class="o">.</span><span class="na">getSelectionModel</span><span class="o">().</span><span class="na">getSelectedItem</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">str</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"无编码"</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">str</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="s">"其他"</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="n">textField</span><span class="o">.</span><span class="na">getText</span><span class="o">()};</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">[]{</span><span class="n">str</span><span class="o">};</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="nc">File</span> <span class="n">logFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">encodeTarget</span><span class="o">.</span><span class="na">getPath</span><span class="o">()</span> <span class="o">+</span> <span class="s">".log"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">logFile</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="n">encodeTarget</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="nc">OutputStreamWriter</span> <span class="n">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OutputStreamWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">logFile</span><span class="o">));</span>
            <span class="nc">FileInputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">encodeSouce</span><span class="o">);</span>
            <span class="nc">Haffuman</span> <span class="n">haffuman</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Haffuman</span><span class="o">(</span><span class="n">logger</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">haffuman</span><span class="o">.</span><span class="na">Encode</span><span class="o">(</span><span class="n">is</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
            <span class="nc">FileOutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">encodeTarget</span><span class="o">);</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">os</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">File</span> <span class="nf">SelectFile</span><span class="o">(</span><span class="nc">String</span> <span class="n">initalPath</span><span class="o">,</span> <span class="nc">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span> <span class="n">filter</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">isOpen</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">FileChooser</span> <span class="n">fileChooser</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileChooser</span><span class="o">();</span>
        <span class="n">fileChooser</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"打开"</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">initalPath</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">fileChooser</span><span class="o">.</span><span class="na">setInitialDirectory</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">initalPath</span><span class="o">).</span><span class="na">getParentFile</span><span class="o">());</span>
        <span class="k">else</span> <span class="n">fileChooser</span><span class="o">.</span><span class="na">setInitialDirectory</span><span class="o">(</span><span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"user.dir"</span><span class="o">)));</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">filter</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="n">fileChooser</span><span class="o">.</span><span class="na">getExtensionFilters</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">filter</span><span class="o">);</span>
        <span class="nc">File</span> <span class="n">selectedFile</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">isOpen</span><span class="o">)</span>
            <span class="n">selectedFile</span> <span class="o">=</span> <span class="n">fileChooser</span><span class="o">.</span><span class="na">showOpenDialog</span><span class="o">(</span><span class="nc">Entrance</span><span class="o">.</span><span class="na">stage</span><span class="o">);</span>
        <span class="k">else</span>
            <span class="n">selectedFile</span> <span class="o">=</span> <span class="n">fileChooser</span><span class="o">.</span><span class="na">showSaveDialog</span><span class="o">(</span><span class="nc">Entrance</span><span class="o">.</span><span class="na">stage</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">selectedFile</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">selectedFile</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@FXML</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">onDecoding</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">decodeTarget</span> <span class="o">=</span> <span class="nc">SelectFile</span><span class="o">(</span><span class="n">decodeTarget</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">decodeTarget</span><span class="o">.</span><span class="na">getPath</span><span class="o">(),</span>
                <span class="k">new</span> <span class="nc">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span><span class="o">(</span><span class="s">"任意文件"</span><span class="o">,</span> <span class="s">"*.*"</span><span class="o">),</span> <span class="kc">false</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">decodeTarget</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">decodeOrigin</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="k">return</span><span class="o">;</span>

        <span class="nc">File</span> <span class="n">logFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">decodeTarget</span><span class="o">.</span><span class="na">getPath</span><span class="o">()</span> <span class="o">+</span> <span class="s">".log"</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">logFile</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="n">decodeTarget</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="nc">OutputStreamWriter</span> <span class="n">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">OutputStreamWriter</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">logFile</span><span class="o">));</span>
            <span class="nc">FileInputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">decodeOrigin</span><span class="o">);</span>
            <span class="nc">Haffuman</span> <span class="n">haffuman</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Haffuman</span><span class="o">(</span><span class="n">logger</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="n">haffuman</span><span class="o">.</span><span class="na">decode</span><span class="o">(</span><span class="n">is</span><span class="o">);</span>
            <span class="nc">FileOutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">decodeTarget</span><span class="o">);</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">logger</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">os</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="nd">@FXML</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">onSelectDecodingOrigin</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">decodeOrigin</span> <span class="o">=</span> <span class="nc">SelectFile</span><span class="o">(</span><span class="n">decodeOrigin</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="n">decodeOrigin</span><span class="o">.</span><span class="na">getPath</span><span class="o">(),</span>
                <span class="k">new</span> <span class="nc">FileChooser</span><span class="o">.</span><span class="na">ExtensionFilter</span><span class="o">(</span><span class="s">"哈夫曼编码二进制"</span><span class="o">,</span> <span class="s">"*.haf"</span><span class="o">),</span> <span class="kc">true</span><span class="o">);</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E7%BC%96%E7%A8%8B/'>编程</a>, <a href='/categories/%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91/'>工具开发</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E7%BC%96%E7%A8%8B/" class="post-tag no-text-decoration" >编程</a> <a href="/tags/%E5%B7%A5%E5%85%B7%E5%BC%80%E5%8F%91/" class="post-tag no-text-decoration" >工具开发</a> <a href="/tags/javafx/" class="post-tag no-text-decoration" >JavaFX</a> <a href="/tags/%E4%BD%9C%E4%B8%9A/" class="post-tag no-text-decoration" >作业</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业 - FEXLA&url=https://fexla.github.io/posts/%E5%9F%BA%E4%BA%8Ejavafx%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8-%E5%AD%A6%E6%A0%A1%E4%BD%9C%E4%B8%9A/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业 - FEXLA&u=https://fexla.github.io/posts/%E5%9F%BA%E4%BA%8Ejavafx%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8-%E5%AD%A6%E6%A0%A1%E4%BD%9C%E4%B8%9A/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=FexCodec-基于JavaFX和哈夫曼算法的解压缩编解码器-学校作业 - FEXLA&url=https://fexla.github.io/posts/%E5%9F%BA%E4%BA%8Ejavafx%E7%9A%84%E7%BC%96%E8%A7%A3%E7%A0%81%E5%99%A8-%E5%AD%A6%E6%A0%A1%E4%BD%9C%E4%B8%9A/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>最近更新</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/C++%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E8%AF%AD%E8%A8%80-%E7%AC%94%E8%AE%B0-%E7%AC%AC3%E7%AB%A0-C++%E6%A6%82%E8%A7%88-%E6%8A%BD%E8%B1%A1%E6%9C%BA%E5%88%B6/">《C++程序设计语言》笔记 第3章 C++概览：抽象机制</a><li><a href="/posts/%E7%AE%97%E6%B3%95%E6%97%A5%E5%AF%84-2022-08-04/">算法日寄[2022-08-04]</a><li><a href="/posts/%E7%AE%97%E6%B3%95%E6%97%A5%E5%AF%84-2022-07-21/">算法日寄[2022-07-21]</a><li><a href="/posts/%E7%AE%97%E6%B3%95%E6%97%A5%E5%AF%84-2022-07-19/">算法日寄[2022-07-19]</a><li><a href="/posts/%E7%AE%97%E6%B3%95%E6%97%A5%E5%AF%84-2022-07-18/">算法日寄[2022-07-18]</a></ul></div><div id="access-tags"> <span>热门标签</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E7%BC%96%E7%A8%8B/">编程</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a> <a class="post-tag" href="/tags/%E6%B8%B8%E6%88%8F/">游戏</a> <a class="post-tag" href="/tags/%E5%8A%A8%E6%80%81%E6%95%B0%E5%80%BC%E7%BD%91%E7%BB%9C/">动态数值网络</a> <a class="post-tag" href="/tags/%E6%95%B0%E5%80%BC/">数值</a> <a class="post-tag" href="/tags/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/">框架设计</a> <a class="post-tag" href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">游戏开发</a> <a class="post-tag" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/ui/">UI</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">文章内容</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/%E6%B8%B8%E6%88%8F%E4%B8%AD%E7%9A%84%E5%A4%96%E9%83%A8%E7%A9%BA%E9%97%B4%E8%AE%BE%E8%AE%A1/"><div class="card-body"> <span class="timeago small" >2021-11-08<i class="unloaded">2021-11-08T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>游戏中的外部空间设计</h3><div class="text-muted small"><p> 正文 ​　　游戏中的外部空间设计可以起到非常多的作用，好的设计可以指引玩家做出设计师预想中的行为，可以调动玩家的情绪。每个游戏都发生在某种空间中，相比于现实，游戏的空间可以不是连续而是离散的，可以不是三维而是二维甚至一维的（比如九宫格游戏中的空间就可以视为一维空间上9个离散的点）或是在零维上（比如“二十问”这类的游戏），可以是若干个连接或不连接的有界区域。这里我们讨论的空间是指游戏中视觉角...</p></div></div></a></div><div class="card"> <a href="/posts/%E5%8A%A8%E6%80%81%E5%B1%9E%E6%80%A7%E7%BD%91%E7%BB%9C%E6%A1%86%E6%9E%B6-1-%E5%89%8D%E8%A8%80/"><div class="card-body"> <span class="timeago small" >2021-11-11<i class="unloaded">2021-11-11T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>动态属性网络框架-1 前言</h3><div class="text-muted small"><p> 简介 　　我最近设计开发了一个游戏数值（程序，）框架，我将它命名为动态属性网络（节点是动态属性的动态网络），其作用是用一个可视化的、动态的数值模型，维护多级属性的所有属性之间的运算关系，和维护数值载体身上的一系列数值。它适用于开发数值属性非常多的游戏，如太吾绘卷、鬼谷八荒、群星。 　　我的基本想法是：以太吾绘卷为例（觉得文字太繁琐可以直接看我的示意图），太吾绘卷有非常多的属性种类，属性之...</p></div></div></a></div><div class="card"> <a href="/posts/%E4%BD%BF%E7%94%A8PlantUML%E5%88%B6%E4%BD%9C%E7%A8%8B%E5%BA%8F%E7%A4%BA%E6%84%8F%E5%9B%BE/"><div class="card-body"> <span class="timeago small" >2021-11-12<i class="unloaded">2021-11-12T00:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>使用PlantUML制作程序示意图</h3><div class="text-muted small"><p> 感觉不用UML来解释自己的程序还是太难说清楚了，所以我在Rider里装了一个PlantUML的插件，简单学了一下用法。 下面是大概效果： @startuml left to right direction map node1{ from =&gt; to } map node2{ from =&gt; to } map node{ from =&gt; to } node1::to ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/%E5%8A%A8%E6%80%81%E5%B1%9E%E6%80%A7%E7%BD%91%E7%BB%9C%E6%A1%86%E6%9E%B6-5-%E5%8F%AF%E8%A7%86%E5%8C%96%E4%BA%8C/" class="btn btn-outline-primary" prompt="上一篇"><p>动态属性网络框架-5 可视化（二）</p></a> <a href="/posts/%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1%E8%89%BA%E6%9C%AF-%E6%B8%B8%E6%88%8F%E9%80%9A%E8%BF%87%E8%BF%AD%E4%BB%A3%E6%8F%90%E9%AB%98-%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="btn btn-outline-primary" prompt="下一篇"><p>游戏设计艺术-游戏通过迭代提高-读书笔记</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/fexla">fexla</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0"> 本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">热门标签</h4><a class="post-tag" href="/tags/%E7%BC%96%E7%A8%8B/">编程</a> <a class="post-tag" href="/tags/%E7%AE%97%E6%B3%95/">算法</a> <a class="post-tag" href="/tags/%E6%B8%B8%E6%88%8F/">游戏</a> <a class="post-tag" href="/tags/%E5%8A%A8%E6%80%81%E6%95%B0%E5%80%BC%E7%BD%91%E7%BB%9C/">动态数值网络</a> <a class="post-tag" href="/tags/%E6%95%B0%E5%80%BC/">数值</a> <a class="post-tag" href="/tags/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1/">框架设计</a> <a class="post-tag" href="/tags/%E6%B8%B8%E6%88%8F%E5%BC%80%E5%8F%91/">游戏开发</a> <a class="post-tag" href="/tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/">读书笔记</a> <a class="post-tag" href="/tags/c/">C++</a> <a class="post-tag" href="/tags/ui/">UI</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
